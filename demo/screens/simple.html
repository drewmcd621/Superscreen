<html>
<head>
  <style>
    body
    {
      margin:0;
    }
  </style>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.8/socket.io.min.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.6/d3.min.js"></script>
  <script>
  var socket = io();
  $(document).ready(function(){
    var r_name = /\?name=([^&]+)/;
    var match = r_name.exec(window.location.href);

    var name = match[1];
    socket.emit('handshake', "hello I'm " + name);

    socket.on("newObj", function(data){
      if(name == data.name)
      {
        console.log(data);
        blink();

      }
    });

    var h = $("body").height();
    var w = $("body").width();

    var svg = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

    function Ball(canvass, posX, posY, speedX, speedY) {
      this.dX = speedX;
      this.dY = speedY;
      this.x = posX;
      this.y = posY;
      this.svg = canvass;
      var ballObj = this;
      this.rad = 5;

      this.ball = canvass.append('circle')
                         .attr("r", ballObj.rad)
                         .attr("cx", ballObj.x)
                         .attr("cy", ballObj.y)
                         .style("fill","red");
      this.move = function(){
        ballObj.x += ballObj.dX;
        ballObj.y += ballObj.dY;

        ballObj.ball.attr("cx", ballObj.x)
                    .attr("cy", ballObj.y);
        ballObj.checkWall();

      }

      this.checkWall = function()
      {
        var bb = ballObj.svg.node().getBBox();
        console.log(bb);
        var hsvg = bb.height;
        var wsvg = bb.width;

        if(ballObj.y - ballObj.rad <= 0)
        {
          ballObj.dY *= -1;
        }
        if(ballObj.y + ballObj.rad >= hsvg)
        {
          ballObj.dY *= -1;
        }

        if(ballObj.x - ballObj.rad <= 0)
        {
          ballObj.dX *= -1;
        }
        if(ballObj.x + ballObj.rad >= wsvg)
        {
          ballObj.dX *= -1;
        }


      }
    }

    var balls = [];

    function scaleX(p)
    {
      return p * w;
    }

    function scaleY(p)
    {
      return p * h;
    }

    balls.push(new Ball(svg, scaleX(Math.random()), scaleY(Math.random()), Math.random()*6 - 3, Math.random()*6 - 3));
    balls.push(new Ball(svg, scaleX(Math.random()), scaleY(Math.random()), Math.random()*6 - 3, Math.random()*6 - 3));

    d3.timer(function () {
      for (var i = 0; i < balls.length; ++i) {
            balls[i].move();
        }
    }, 17); //A delay of 17 is about 60 fps

  });



  </script>
</head>
<body>

</body>
</html>
